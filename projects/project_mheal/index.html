<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>MHEAL Clear Lung Project | Joey Costello</title> <meta name="author" content="Joey Costello"/> <meta name="description" content="a low-cost vest to diagnose pneumonia in children"/> <meta name="keywords" content="brain-computer-interface, machine-learning, signal-processing"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://jtcostello.github.io/projects/project_mheal/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Joey¬†</span>Costello</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">research</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/photography/">photography</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">MHEAL Clear Lung Project</h1> <p class="post-description">a low-cost vest to diagnose pneumonia in children</p> </header> <article> <p>December 2019 <br></p> <h3 id="a-new-diagnostic-tool-for-childhood-pneumonia">A New Diagnostic Tool for Childhood Pneumonia</h3> <p>Joey Costello and John Obeid</p> <div class="row"> <div class="col-5 col-sm-3 mt-3 mt-md-0 mx-auto d-block"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/clearlunglogo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/clearlunglogo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/clearlunglogo-1400.webp"></source> <img src="/assets/img/mheal/clearlunglogo.png" class="img-fluid" width="auto" height="auto" title="logo" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="diagnosing-pneumonia-in-children">Diagnosing Pneumonia in Children</h4> <p>Pneumonia is the largest source of mortality in children in developing countries, accounting for nearly two million deaths each year. Since pneumonia is treatable, the problem lies in diagnosis; unrefined diagnostic techniques result in the infection going undiagnosed or frequently misdiagnosed as malaria. Our group, the Clear Lung Project, has been developing a low-cost, intelligent diagnostic tool to help solve the challenges of diagnosing pneumonia in resource-limited areas.</p> <p>When fully completed, our diagnostic tool will incorporate a wearable vest to record lung sounds from the patient and a viewing screen where the physician can see the result. Upon seeing a patient with a breathing problem, a physician or health professional would have the patient wear the system, which would record lung sounds as they breathe. After analyzing the recorded sounds, the system would predict if pneumonia is a likely diagnosis and suggest seeking more advanced medical expertise for treatment or further diagnostic scans.</p> <p>When listening to the lungs with a stethoscope, trained physicians typically listen to several locations on the patient‚Äôs back. Similarly, our system uses multiple microphones positioned across the back to detect localized lung sounds including coughs, wheezing, and crackles. This year we completed a prototype recording system and are in the process of developing machine learning algorithms to analyze the audio recordings and make a diagnostic prediction.</p> <h4 id="based-on-a-raspberry-pi-computer">Based on a Raspberry Pi Computer</h4> <p>The full system has two main parts: a vest worn by the patient that records lung sounds, and a main control unit that controls recording and displays results. At the core of the system we used a Raspberry Pi computer, which is small, inexpensive ($35), and capable of performing all the required processing. After the user starts the system, the Pi records audio from four piezo contact microphones, analyzes the audio through a machine-learning algorithm, and outputs its diagnosis to the display.</p> <p>One issue with the Pi is its lack of analog inputs and real-time computing ability; this means an external board is needed for recording audio. We first tried using the Arduino-based Teensy board which is inexpensive and can record four channels at 48 KHz. However, we ran into consistency issues streaming the data through the I2S interface back to the Pi for processing. Luckily, we found a <a href="http://www.audioinjector.net/rpi-octo-hat" target="_blank" rel="noopener noreferrer">multi-channel audio board built for the Pi</a>, which can record up to six channels. The Pi sees the board as a standard audio interface so any recording software can be used.</p> <div class="row align-items-center"> <div class="col-7 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/system%20internals-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/system%20internals-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/system%20internals-1400.webp"></source> <img src="/assets/img/mheal/system%20internals.png" class="img-fluid" width="auto" height="auto" title="system internals" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-3 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/piezo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/piezo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/piezo-1400.webp"></source> <img src="/assets/img/mheal/piezo.png" class="img-fluid" width="auto" height="auto" title="piezo" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="improving-recording-quality">Improving Recording Quality</h4> <p>Initially, we connected the piezo microphones directly to the audio board but the recordings were very high-pitched, ‚Äútinny‚Äù sounding. After some research we discovered the problem was an impedance mismatch between the piezo and the audio line-in input. As shown in the plot below (from <a href="http://www.richardmudhar.com/using-piezo-contact-mics-right/" target="_blank" rel="noopener noreferrer">this useful blog post</a>), the mismatch creates a high-pass filter that attenuates low frequencies. Lung sounds like crackles and wheezes have frequencies of 100-200 Hz making it critical to accurately capture these lower frequencies.</p> <div class="row"> <div class="col-5 mt-3 mt-md-0 mx-auto"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/impedance-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/impedance-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/impedance-1400.webp"></source> <img src="/assets/img/mheal/impedance.png" class="img-fluid" width="auto" height="auto" title="impedance" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>To solve the problem, we designed an amplifier circuit to act as a higher load impedance and reduce the filtering effect (and amplify the signal slightly). The circuit (below) is based on <a href="http://www.richardmudhar.com/piezo-contact-microphone-hi-z-amplifier-low-noise-version/" target="_blank" rel="noopener noreferrer">Richard Mudhar‚Äôs piezo amplifier</a>.</p> <div class="row"> <div class="col-7 mt-3 mt-md-0 mx-auto"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/schematic-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/schematic-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/schematic-1400.webp"></source> <img src="/assets/img/mheal/schematic.png" class="img-fluid" width="auto" height="auto" title="schematic" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We designed a custom PCB with four of these circuits to take in four microphone inputs, and output to the Pi through two ethernet cables. The board has two additional pins for eventually adding other sensors (like breathing rate and pulse-oximetry). Everything was laid out in Eagle and we had the boards printed through OSHPark for a few dollars. We then 3D printed a simple case with snap-on lid to protect the board, and the case mounts on the back of the patient‚Äôs vest.</p> <p>PCB Front, PCB Back, and assembled PCB with case:</p> <div class="row d-flex align-items-center"> <div class="col-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/pcb%201-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/pcb%201-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/pcb%201-1400.webp"></source> <img src="/assets/img/mheal/pcb%201.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="pcb" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/pcb%202-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/pcb%202-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/pcb%202-1400.webp"></source> <img src="/assets/img/mheal/pcb%202.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="pcb" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/open%20unit-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/open%20unit-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/open%20unit-1400.webp"></source> <img src="/assets/img/mheal/open%20unit.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="schematic" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="vest-based-recording-system">Vest-Based Recording System</h4> <p>The full system consists of the wearable-vest and control unit. We modified a weight-lifting vest since it already had numerous straps and attachment points to hold the microphones and the pre-amplifier board. We designed 3D printed mounts to hold the microphones and connect to the vest through velcro for adjustability. Two ethernet cables carry the analog microphone signals to the main control unit for analysis.</p> <p>Wearable-vest and control unit:</p> <div class="row"> <div class="col-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/vestworn-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/vestworn-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/vestworn-1400.webp"></source> <img src="/assets/img/mheal/vestworn.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="vest on person" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mheal/vest%20and%20unit-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mheal/vest%20and%20unit-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mheal/vest%20and%20unit-1400.webp"></source> <img src="/assets/img/mheal/vest%20and%20unit.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="vest microphones" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="future-work">Future Work</h4> <p>This year we completed a working prototype with adjustability to allow for testing different microphone positions and user sizes. Next, we plan on adding buttons for a user interface as well as other sensors to aid in diagnosis (heart rate, breathing rate, pulse oximetry). Our largest challenge going forward will be recording enough example lung sounds from patients with and without pneumonia to then train accurate machine-learning algorithms. We hope to soon take our system abroad to get doctor and patient feedback to guide further developments.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> ¬© Copyright 2023 Joey Costello. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>